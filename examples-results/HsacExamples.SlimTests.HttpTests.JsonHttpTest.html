<html><head><title>HsacExamples.SlimTests.HttpTests.JsonHttpTest</title><meta http-equiv='Content-Type' content='text/html;charset=UTF-8'/><link rel='stylesheet' type='text/css' href='css/fitnesse.css'/><script src='javascript/jquery-1.11.3.min.js' type='text/javascript'></script><script src='javascript/fitnesse.js' type='text/javascript'></script></head><body><header><h2>HsacExamples.SlimTests.HttpTests.JsonHttpTest</h2></header><article><br/>Example usage of making HTTP calls to get results in <a href="http://json.org">JSON</a> notation and using <a href="http://goessner.net/articles/JsonPath/">JsonPath</a> to validate the response's content.<br/><br/>First a simple GET request.<br/><br/><table>
	<tr class="slimRowTitle">
		<td>script</td>
		<td colspan="3"><span class="pass">json http test</span></td>
	</tr>
	<tr class="slimRowColor8">
		<td><span class="fail">get from</span></td>
		<td colspan="3"><a href="http://echo.jsontest.com/key/value/one/two">http://echo.jsontest.com/key/value/one/two</a></td>
	</tr>
	<tr class="slimRowColor9">
		<td>show</td>
		<td colspan="3">response</td>
	<td>
&lt;html&gt;&lt;head&gt;
&lt;meta http-equiv="content-type" content="text/html;charset=utf-8"&gt;
&lt;title&gt;503 Over Quota&lt;/title&gt;
&lt;style&gt;&lt;!--
body {font-family: arial,sans-serif}
div.nav {margin-top: 1ex}
div.nav A {font-size: 10pt; font-family: arial,sans-serif}
span.nav {font-size: 10pt; font-family: arial,sans-serif; font-weight: bold}
div.nav A,span.big {font-size: 12pt; color: #0000cc}
div.nav A {font-size: 10pt; color: black}
A.l:link {color: #6f6f6f}
A.u:link {color: green}
//--&gt;&lt;/style&gt;

&lt;/head&gt;
&lt;body text=#000000 bgcolor=#ffffff&gt;
&lt;table border=0 cellpadding=2 cellspacing=0 width=100%&gt;
&lt;tr&gt;&lt;td bgcolor=#3366cc&gt;&lt;font face=arial,sans-serif color=#ffffff&gt;&lt;b&gt;Error&lt;/b&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;blockquote&gt;
&lt;H1&gt;Over Quota&lt;/H1&gt;
This application is temporarily over its serving quota.  Please try again later.

&lt;p&gt;
&lt;/blockquote&gt;
&lt;table width=100% cellpadding=0 cellspacing=0&gt;&lt;tr&gt;&lt;td bgcolor=#3366cc&gt;&lt;img alt="" width=1 height=4&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/body&gt;&lt;/html&gt;
</td></tr>
	<tr class="slimRowColor0">
		<td>check</td>
		<td>json path</td>
		<td>$.key</td>
		<td>[<span class="diff">nu</span>l<span class="diff">l</span>] <span class="fail">expected [</span><span class="diff">va</span><span class="fail">l</span><span class="diff">ue</span><span class="fail">]</span></td>
	</tr>
	<tr class="slimRowColor0">
		<td>check</td>
		<td>json path</td>
		<td>$.one</td>
		<td>[<span class="diff">null</span>] <span class="fail">expected [</span><span class="diff">two</span><span class="fail">]</span></td>
	</tr>
</table>
<br/><br/>Then a POST, showing the multiple notations of JsonPath expressions supported (notice that adding the '$.' prefix is not required).<br/><br/><span class="meta">variable defined: BAD_BODY= {{{
json={"key":"value"
}}} </span>
<br/><br/><table>
	<tr class="slimRowTitle">
		<td>script</td>
		<td colspan="3"><span class="pass">json http test</span></td>
	</tr>
	<tr class="slimRowColor4">
		<td><span class="fail">post</span></td>
		<td><pre>
json={"key":"value"
</pre></td>
		<td>to</td>
		<td><a href="http://validate.jsontest.com/">http://validate.jsontest.com/</a></td>
	</tr>
	<tr class="slimRowColor9">
		<td>show</td>
		<td colspan="3">response</td>
	<td>
&lt;html&gt;&lt;head&gt;
&lt;meta http-equiv="content-type" content="text/html;charset=utf-8"&gt;
&lt;title&gt;503 Over Quota&lt;/title&gt;
&lt;style&gt;&lt;!--
body {font-family: arial,sans-serif}
div.nav {margin-top: 1ex}
div.nav A {font-size: 10pt; font-family: arial,sans-serif}
span.nav {font-size: 10pt; font-family: arial,sans-serif; font-weight: bold}
div.nav A,span.big {font-size: 12pt; color: #0000cc}
div.nav A {font-size: 10pt; color: black}
A.l:link {color: #6f6f6f}
A.u:link {color: green}
//--&gt;&lt;/style&gt;

&lt;/head&gt;
&lt;body text=#000000 bgcolor=#ffffff&gt;
&lt;table border=0 cellpadding=2 cellspacing=0 width=100%&gt;
&lt;tr&gt;&lt;td bgcolor=#3366cc&gt;&lt;font face=arial,sans-serif color=#ffffff&gt;&lt;b&gt;Error&lt;/b&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;blockquote&gt;
&lt;H1&gt;Over Quota&lt;/H1&gt;
This application is temporarily over its serving quota.  Please try again later.

&lt;p&gt;
&lt;/blockquote&gt;
&lt;table width=100% cellpadding=0 cellspacing=0&gt;&lt;tr&gt;&lt;td bgcolor=#3366cc&gt;&lt;img alt="" width=1 height=4&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/body&gt;&lt;/html&gt;
</td></tr>
	<tr class="slimRowColor0">
		<td>check</td>
		<td>json path</td>
		<td>$.validate</td>
		<td>[<span class="diff">nu</span>l<span class="diff">l</span>] <span class="fail">expected [</span><span class="diff">fa</span><span class="fail">l</span><span class="diff">se</span><span class="fail">]</span></td>
	</tr>
	<tr class="slimRowColor0">
		<td>check</td>
		<td>json path</td>
		<td>validate</td>
		<td>[<span class="diff">nu</span>l<span class="diff">l</span>] <span class="fail">expected [</span><span class="diff">fa</span><span class="fail">l</span><span class="diff">se</span><span class="fail">]</span></td>
	</tr>
	<tr class="slimRowColor0">
		<td>check</td>
		<td>json path</td>
		<td>.validate</td>
		<td>[<span class="diff">nu</span>l<span class="diff">l</span>] <span class="fail">expected [</span><span class="diff">fa</span><span class="fail">l</span><span class="diff">se</span><span class="fail">]</span></td>
	</tr>
	<tr class="slimRowColor0">
		<td>check</td>
		<td>json path</td>
		<td>$['validate']</td>
		<td>[<span class="diff">nu</span>l<span class="diff">l</span>] <span class="fail">expected [</span><span class="diff">fa</span><span class="fail">l</span><span class="diff">se</span><span class="fail">]</span></td>
	</tr>
	<tr class="slimRowColor0">
		<td>check</td>
		<td>json path</td>
		<td>['validate']</td>
		<td>[<span class="diff">nu</span>l<span class="diff">l</span>] <span class="fail">expected [</span><span class="diff">fa</span><span class="fail">l</span><span class="diff">se</span><span class="fail">]</span></td>
	</tr>
</table>
<br/><br/>Next another POST, showing that expressions resulting in a boolean or integer value are recognized and can be used accordingly by the script table. Furthermore expressions returning more than a single member are supported.<br/><br/><span class="meta">variable defined: GOOD_BODY= {{{
json={"key":"value"}
}}} </span>
<br/><br/><table>
	<tr class="slimRowTitle">
		<td>script</td>
		<td colspan="5"><span class="pass">json http test</span></td>
	</tr>
	<tr class="slimRowColor4">
		<td><span class="fail">post</span></td>
		<td><pre>
json={"key":"value"}
</pre></td>
		<td>to</td>
		<td colspan="3"><a href="http://validate.jsontest.com/">http://validate.jsontest.com/</a></td>
	</tr>
	<tr class="slimRowColor9">
		<td>show</td>
		<td colspan="5">response</td>
	<td>
&lt;html&gt;&lt;head&gt;
&lt;meta http-equiv="content-type" content="text/html;charset=utf-8"&gt;
&lt;title&gt;503 Over Quota&lt;/title&gt;
&lt;style&gt;&lt;!--
body {font-family: arial,sans-serif}
div.nav {margin-top: 1ex}
div.nav A {font-size: 10pt; font-family: arial,sans-serif}
span.nav {font-size: 10pt; font-family: arial,sans-serif; font-weight: bold}
div.nav A,span.big {font-size: 12pt; color: #0000cc}
div.nav A {font-size: 10pt; color: black}
A.l:link {color: #6f6f6f}
A.u:link {color: green}
//--&gt;&lt;/style&gt;

&lt;/head&gt;
&lt;body text=#000000 bgcolor=#ffffff&gt;
&lt;table border=0 cellpadding=2 cellspacing=0 width=100%&gt;
&lt;tr&gt;&lt;td bgcolor=#3366cc&gt;&lt;font face=arial,sans-serif color=#ffffff&gt;&lt;b&gt;Error&lt;/b&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;blockquote&gt;
&lt;H1&gt;Over Quota&lt;/H1&gt;
This application is temporarily over its serving quota.  Please try again later.

&lt;p&gt;
&lt;/blockquote&gt;
&lt;table width=100% cellpadding=0 cellspacing=0&gt;&lt;tr&gt;&lt;td bgcolor=#3366cc&gt;&lt;img alt="" width=1 height=4&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/body&gt;&lt;/html&gt;
</td></tr>
	<tr class="slimRowColor0">
		<td>check</td>
		<td>json path</td>
		<td>validate</td>
		<td colspan="3">[<span class="diff">n</span>u<span class="diff">ll</span>] <span class="fail">expected [</span><span class="diff">tr</span><span class="fail">u</span><span class="diff">e</span><span class="fail">]</span></td>
	</tr>
	<tr class="slimRowColor8">
		<td><span class="fail">ensure</span></td>
		<td>json path</td>
		<td colspan="4">validate</td>
	</tr>
	<tr class="slimRowColor0">
		<td>check</td>
		<td>json path</td>
		<td>size</td>
		<td colspan="3">[<span class="diff">null</span>] <span class="fail">expected [</span><span class="diff">&gt;0</span><span class="fail">]</span></td>
	</tr>
	<tr class="slimRowColor0">
		<td>check</td>
		<td>json path count</td>
		<td>$.*</td>
		<td colspan="3"><span class="fail">0&gt;=5</span></td>
	</tr>
	<tr class="slimRowColor9">
		<td>show</td>
		<td>all json path matches</td>
		<td colspan="4">*</td>
	<td>null</td></tr>
	<tr class="exception closed">
		<td class="error">check</td>
		<td class="error">element</td>
		<td class="error">1</td>
		<td class="error">of json path</td>
		<td class="error">$.*</td>
		<td class="error">false</td>
	</tr><tr class="exception-detail closed-detail"><td colspan="6"><pre>__EXCEPTION__:java.lang.IndexOutOfBoundsException: Index: 1, Size: 0
	at java.util.ArrayList.rangeCheck(ArrayList.java:657) [rt.jar:1.8.0_151]
	at java.util.ArrayList.get(ArrayList.java:433) [rt.jar:1.8.0_151]
	at nl.hsac.fitnesse.fixture.slim.JsonHttpTest.elementOfJsonPath(JsonHttpTest.java:91) [file:/home/travis/build/fhoeben/hsac-fitnesse-fixtures/wiki/fixtures/]
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) [rt.jar:1.8.0_151]
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) [rt.jar:1.8.0_151]
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) [rt.jar:1.8.0_151]
	at java.lang.reflect.Method.invoke(Method.java:498) [rt.jar:1.8.0_151]
	at fitnesse.slim.fixtureInteraction.DefaultInteraction.methodInvoke(DefaultInteraction.java:221) [fitnesse-20180127.jar:20180127]
	at nl.hsac.fitnesse.fixture.slim.SlimFixture.invoke(SlimFixture.java:54) [file:/home/travis/build/fhoeben/hsac-fitnesse-fixtures/wiki/fixtures/]
	at nl.hsac.fitnesse.fixture.slim.SlimFixture.aroundSlimInvoke(SlimFixture.java:34) [file:/home/travis/build/fhoeben/hsac-fitnesse-fixtures/wiki/fixtures/]
	at sun.reflect.GeneratedMethodAccessor1.invoke(Unknown Source) [n/a]
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) [rt.jar:1.8.0_151]
	at java.lang.reflect.Method.invoke(Method.java:498) [rt.jar:1.8.0_151]
	at fitnesse.slim.fixtureInteraction.DefaultInteraction.methodInvoke(DefaultInteraction.java:221) [fitnesse-20180127.jar:20180127]
	at fitnesse.slim.fixtureInteraction.DefaultInteraction.callMethod(DefaultInteraction.java:204) [fitnesse-20180127.jar:20180127]
	at fitnesse.slim.fixtureInteraction.DefaultInteraction.invokeMethod(DefaultInteraction.java:188) [fitnesse-20180127.jar:20180127]
	at fitnesse.slim.fixtureInteraction.DefaultInteraction.findAndInvoke(DefaultInteraction.java:166) [fitnesse-20180127.jar:20180127]
	at fitnesse.slim.MethodExecutor.findAndInvoke(MethodExecutor.java:18) [fitnesse-20180127.jar:20180127]
	at fitnesse.slim.FixtureMethodExecutor.execute(FixtureMethodExecutor.java:18) [fitnesse-20180127.jar:20180127]
	at fitnesse.slim.StatementExecutor.getMethodExecutionResult(StatementExecutor.java:139) [fitnesse-20180127.jar:20180127]
	at fitnesse.slim.StatementExecutor.call(StatementExecutor.java:112) [fitnesse-20180127.jar:20180127]
	at fitnesse.slim.instructions.CallInstruction.executeInternal(CallInstruction.java:35) [fitnesse-20180127.jar:20180127]
	at fitnesse.slim.instructions.Instruction.execute(Instruction.java:29) [fitnesse-20180127.jar:20180127]
	at fitnesse.slim.ListExecutor$Executive.executeStatement(ListExecutor.java:49) [fitnesse-20180127.jar:20180127]
	at fitnesse.slim.ListExecutor$Executive.executeStatements(ListExecutor.java:43) [fitnesse-20180127.jar:20180127]
	at fitnesse.slim.ListExecutor.execute(ListExecutor.java:85) [fitnesse-20180127.jar:20180127]
	at fitnesse.slim.SlimServer.executeInstructions(SlimServer.java:82) [fitnesse-20180127.jar:20180127]
	at fitnesse.slim.SlimServer.processOneSetOfInstructions(SlimServer.java:75) [fitnesse-20180127.jar:20180127]
	at fitnesse.slim.SlimServer.tryProcessInstructions(SlimServer.java:62) [fitnesse-20180127.jar:20180127]
	at fitnesse.slim.SlimServer.serve(SlimServer.java:47) [fitnesse-20180127.jar:20180127]
	at fitnesse.testsystems.slim.InProcessSlimClient$1.run(InProcessSlimClient.java:55) [fitnesse-20180127.jar:20180127]
	at java.lang.Thread.run(Thread.java:748) [rt.jar:1.8.0_151]</pre></td></tr>
</table>
<br/><br/>Next another POST, posting of url-enoded values defined in the wiki.<br/><br/><table>
	<tr class="slimRowTitle">
		<td>script</td>
		<td colspan="3"><span class="pass">json http test</span></td>
	</tr>
	<tr class="slimRowColor5">
		<td>set value</td>
		<td>{"key":"value 2"}</td>
		<td>for</td>
		<td>json</td>
	</tr>
	<tr class="slimRowColor1">
		<td><span class="fail">post values to</span></td>
		<td colspan="3"><a href="http://validate.jsontest.com/">http://validate.jsontest.com/</a></td>
	</tr>
	<tr class="slimRowColor9">
		<td>show</td>
		<td colspan="3">response</td>
	<td>
&lt;html&gt;&lt;head&gt;
&lt;meta http-equiv="content-type" content="text/html;charset=utf-8"&gt;
&lt;title&gt;503 Over Quota&lt;/title&gt;
&lt;style&gt;&lt;!--
body {font-family: arial,sans-serif}
div.nav {margin-top: 1ex}
div.nav A {font-size: 10pt; font-family: arial,sans-serif}
span.nav {font-size: 10pt; font-family: arial,sans-serif; font-weight: bold}
div.nav A,span.big {font-size: 12pt; color: #0000cc}
div.nav A {font-size: 10pt; color: black}
A.l:link {color: #6f6f6f}
A.u:link {color: green}
//--&gt;&lt;/style&gt;

&lt;/head&gt;
&lt;body text=#000000 bgcolor=#ffffff&gt;
&lt;table border=0 cellpadding=2 cellspacing=0 width=100%&gt;
&lt;tr&gt;&lt;td bgcolor=#3366cc&gt;&lt;font face=arial,sans-serif color=#ffffff&gt;&lt;b&gt;Error&lt;/b&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;blockquote&gt;
&lt;H1&gt;Over Quota&lt;/H1&gt;
This application is temporarily over its serving quota.  Please try again later.

&lt;p&gt;
&lt;/blockquote&gt;
&lt;table width=100% cellpadding=0 cellspacing=0&gt;&lt;tr&gt;&lt;td bgcolor=#3366cc&gt;&lt;img alt="" width=1 height=4&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/body&gt;&lt;/html&gt;
</td></tr>
	<tr class="slimRowColor0">
		<td>check</td>
		<td>json path</td>
		<td>validate</td>
		<td>[<span class="diff">n</span>u<span class="diff">ll</span>] <span class="fail">expected [</span><span class="diff">tr</span><span class="fail">u</span><span class="diff">e</span><span class="fail">]</span></td>
	</tr>
</table>
<br/>Next another POST, posting of url-enoded array of values defined in the wiki.<br/><p class="note">We have to specify 'products\[]' as value name since the service requires a value called 'products[]' and the fixture interprets a value name ending on '[]' as an indicator the value is an array, and will normally not include that postfix in the name of the value sent to the service. By specifying '\[]' we indicate we <i>don't</i> want the brackets removed from the name.</p><br/><table>
	<tr class="slimRowTitle">
		<td>script</td>
		<td colspan="3"><span class="pass">json http test</span></td>
	</tr>
	<tr class="slimRowColor0">
		<td>set values</td>
		<td>televisie-start, internet-fiber-start</td>
		<td>for</td>
		<td>products\[]</td>
	</tr>
	<tr class="slimRowColor1">
		<td><span class="pass">post values to</span></td>
		<td colspan="3"><a href="https://thuis.t-mobile.nl/api/shoppingcart">https://thuis.t-mobile.nl/api/shoppingcart</a></td>
	</tr>
	<tr class="slimRowColor9">
		<td>show</td>
		<td colspan="3">response</td>
	<td><pre>{
    &quot;error&quot;: 0,
    &quot;fields&quot;: {
        &quot;IsConverged&quot;: false,
        &quot;pricing_info&quot;: {
            &quot;initial_onetime&quot;: {
                &quot;price_decimal&quot;: 0,
                &quot;price&quot;: &quot;0,00&quot;,
                &quot;price_id&quot;: &quot;initial_onetime&quot;,
                &quot;pricing_info&quot;: &quot;Eenmalige kosten&quot;
            },
            &quot;initial_monthly&quot;: {
                &quot;price_decimal&quot;: 0,
                &quot;price&quot;: &quot;0,00&quot;,
                &quot;price_id&quot;: &quot;initial_monthly&quot;,
                &quot;pricing_info&quot;: &quot;Maandelijks&quot;
            }
        },
        &quot;order&quot;: {
            &quot;listdiscount&quot;: [],
            &quot;extras&quot;: [],
            &quot;basic_products&quot;: []
        }
    }
}</pre></td></tr>
	<tr class="slimRowColor0">
		<td>check</td>
		<td>json path</td>
		<td>error</td>
		<td><span class="pass">0</span></td>
	</tr>
	<tr class="slimRowColor0">
		<td>check</td>
		<td>json path</td>
		<td>$.fields.pricing_info.initial_onetime.pricing_info</td>
		<td><span class="pass">Eenmalige kosten</span></td>
	</tr>
	<tr class="slimRowColor0">
		<td>check</td>
		<td>json path</td>
		<td>$.fields.pricing_info.initial_monthly.pricing_info</td>
		<td><span class="pass">Maandelijks</span></td>
	</tr>
</table>
<br/>Next a PUT example<br/><span class="meta">variable defined: PUT_BODY= {{{
json={"id": 1,
    "title": "foo",
    "body": "bar",
    "userId": 1}
}}} </span>
<br/><br/><table>
	<tr class="slimRowTitle">
		<td>script</td>
		<td colspan="3"><span class="pass">json http test</span></td>
	</tr>
	<tr class="slimRowColor5">
		<td><span class="pass">put</span></td>
		<td><pre>
json={"id": 1,
    "title": "foo",
    "body": "bar",
    "userId": 1}
</pre></td>
		<td>to</td>
		<td><a href="http://jsonplaceholder.typicode.com/posts/1/">http://jsonplaceholder.typicode.com/posts/1/</a></td>
	</tr>
	<tr class="slimRowColor9">
		<td>show</td>
		<td colspan="3">response</td>
	<td><pre>{
    &quot;json&quot;: &quot;{\&quot;id\&quot;: 1,\n    \&quot;title\&quot;: \&quot;foo\&quot;,\n    \&quot;body\&quot;: \&quot;bar\&quot;,\n    \&quot;userId\&quot;: 1}&quot;,
    &quot;id&quot;: 1
}</pre></td></tr>
	<tr class="slimRowColor0">
		<td>check</td>
		<td>json path</td>
		<td>id</td>
		<td><span class="pass">1&gt;0</span></td>
	</tr>
	<tr class="slimRowColor0">
		<td>check</td>
		<td>json path count</td>
		<td>$.*</td>
		<td><span class="pass">2&gt;=2</span></td>
	</tr>
	<tr class="slimRowColor9">
		<td>show</td>
		<td>all json path matches</td>
		<td colspan="2">*</td>
	<td><div><ul><li>{"id": 1,
    "title": "foo",
    "body": "bar",
    "userId": 1}</li><li>1</li></ul></div></td></tr>
</table>
</article></body></html>
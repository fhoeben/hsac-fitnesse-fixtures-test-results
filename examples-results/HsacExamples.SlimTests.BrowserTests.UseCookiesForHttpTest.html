<html><head><title>HsacExamples.SlimTests.BrowserTests.UseCookiesForHttpTest</title><meta http-equiv='Content-Type' content='text/html;charset=UTF-8'/><link rel='stylesheet' type='text/css' href='css/fitnesse.css'/><script src='javascript/jquery-1.11.3.min.js' type='text/javascript'></script><script src='javascript/fitnesse.js' type='text/javascript'></script></head><body><header><h2>HsacExamples.SlimTests.BrowserTests.UseCookiesForHttpTest</h2></header><article><br/>By taking cookies from a browser's session we can test REST services that are only accessible in after (complex) login procedures.<br/><br/>Here we don't actually test a login procedure. We just validate cookies are copied and subsequent requests by http test can change the cookies stored.<br/><br/>First http test on its own: 2nd request (with cookies from 1st) gets same cookie value.<br/><br/><table>
	<tr class="slimRowTitle">
		<td>script</td>
		<td colspan="3"><span class="pass">http test</span></td>
	</tr>
	<tr class="slimRowColor2">
		<td>set store cookies</td>
		<td colspan="3">true</td>
	</tr>
	<tr class="slimRowColor8">
		<td><span class="pass">get from</span></td>
		<td colspan="3"><a href="https://outlook.live.com/owa/">https://outlook.live.com/owa/</a></td>
	</tr>
	<tr class="slimRowColor0">
		<td>check</td>
		<td>response status</td>
		<td colspan="2"><span class="pass">200</span></td>
	</tr>
	<tr class="slimRowColor9">
		<td>show</td>
		<td colspan="3">response headers</td>
	<td><table class="hash_table">
	<tr class="hash_row">
		<td class="hash_key">Cache-Control</td>
		<td class="hash_value">private</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">Content-Length</td>
		<td class="hash_value">3564</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">Content-Type</td>
		<td class="hash_value">text/html; charset=utf-8</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">Server</td>
		<td class="hash_value">Microsoft-IIS/10.0</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">request-id</td>
		<td class="hash_value">274d347e-eac8-4d4a-8fc7-0f3fa4ae0e93</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">X-CalculatedFETarget</td>
		<td class="hash_value">CY1PR01CU002.internal.outlook.com</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">X-BackEndHttpStatus</td>
		<td class="hash_value">[200, 200]</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">Set-Cookie</td>
		<td class="hash_value">[ClientId=321505A229534A33895E23B51F80B419; expires=Sun, 19-May-2019 16:04:37 GMT; path=/; secure, ClientId=321505A229534A33895E23B51F80B419; expires=Sun, 19-May-2019 16:04:37 GMT; path=/; secure, HostSwitchPrg=; expires=Thu, 19-May-1988 16:04:37 GMT; path=/; secure, OptInPrg=; expires=Thu, 19-May-1988 16:04:37 GMT; path=/; secure, logonLatency=LGN01=636623426773798717; domain=live.com; path=/; secure; HttpOnly, O365Consumer=; expires=Thu, 19-May-1988 16:04:37 GMT; path=/; secure]</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">X-FEProxyInfo</td>
		<td class="hash_value">CY1PR01CA0010.PROD.EXCHANGELABS.COM</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">X-CalculatedBETarget</td>
		<td class="hash_value">CY1PR0501MB1852.namprd05.prod.outlook.com</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">X-RUM-Validated</td>
		<td class="hash_value">1</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">X-Content-Type-Options</td>
		<td class="hash_value">nosniff</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">X-FRAME-OPTIONS</td>
		<td class="hash_value">SAMEORIGIN</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">X-BackEnd-Begin</td>
		<td class="hash_value">2018-05-19T16:04:37.378</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">X-BackEnd-End</td>
		<td class="hash_value">2018-05-19T16:04:37.384</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">X-DiagInfo</td>
		<td class="hash_value">CY1PR0501MB1852</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">X-BEServer</td>
		<td class="hash_value">CY1PR0501MB1852</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">X-UA-Compatible</td>
		<td class="hash_value">IE=EmulateIE7</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">Strict-Transport-Security</td>
		<td class="hash_value">[max-age=31536000; includeSubDomains, max-age=31536000; includeSubDomains]</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">X-FEServer</td>
		<td class="hash_value">[CY1PR01CA0010, DM5PR05CA0014]</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">X-Powered-By</td>
		<td class="hash_value">ASP.NET</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">Date</td>
		<td class="hash_value">Sat, 19 May 2018 16:04:37 GMT</td>
	</tr>
</table></td></tr>
	<tr class="slimRowColor9">
		<td>show</td>
		<td colspan="3">cookie values</td>
	<td><table class="hash_table">
	<tr class="hash_row">
		<td class="hash_key">ClientId</td>
		<td class="hash_value">321505A229534A33895E23B51F80B419</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">logonLatency</td>
		<td class="hash_value">LGN01=636623426773798717</td>
	</tr>
</table></td></tr>
	<tr class="slimRowColor9">
		<td>check not</td>
		<td>cookie value</td>
		<td>ClientId</td>
		<td><span class="pass">null</span></td>
	</tr>
	<tr class="slimRowColor8">
		<td>$clientId1&lt;-[321505A229534A33895E23B51F80B419]</td>
		<td>cookie value</td>
		<td colspan="2">ClientId</td>
	</tr>
	<tr class="slimRowColor8">
		<td>note</td>
		<td colspan="3">see that we get same cookie value again</td>
	</tr>
	<tr class="slimRowColor8">
		<td><span class="pass">get from</span></td>
		<td colspan="3"><a href="https://outlook.live.com/owa/">https://outlook.live.com/owa/</a></td>
	</tr>
	<tr class="slimRowColor0">
		<td>check</td>
		<td>response status</td>
		<td colspan="2"><span class="pass">200</span></td>
	</tr>
	<tr class="slimRowColor9">
		<td>show</td>
		<td colspan="3">response headers</td>
	<td><table class="hash_table">
	<tr class="hash_row">
		<td class="hash_key">Cache-Control</td>
		<td class="hash_value">private</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">Content-Length</td>
		<td class="hash_value">3564</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">Content-Type</td>
		<td class="hash_value">text/html; charset=utf-8</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">Server</td>
		<td class="hash_value">Microsoft-IIS/10.0</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">request-id</td>
		<td class="hash_value">c7e39dfa-8b6a-4818-8f4d-f0b821fc26a2</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">X-CalculatedFETarget</td>
		<td class="hash_value">BY2PR1001CU002.internal.outlook.com</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">X-BackEndHttpStatus</td>
		<td class="hash_value">[200, 200]</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">Set-Cookie</td>
		<td class="hash_value">[HostSwitchPrg=; expires=Thu, 19-May-1988 16:04:37 GMT; path=/; secure, OptInPrg=; expires=Thu, 19-May-1988 16:04:37 GMT; path=/; secure, logonLatency=LGN01=636623426774951346; domain=live.com; path=/; secure; HttpOnly, O365Consumer=; expires=Thu, 19-May-1988 16:04:37 GMT; path=/; secure]</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">X-FEProxyInfo</td>
		<td class="hash_value">BY2PR1001CA0073.NAMPRD10.PROD.OUTLOOK.COM</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">X-CalculatedBETarget</td>
		<td class="hash_value">BY2PR05MB2311.namprd05.prod.outlook.com</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">X-RUM-Validated</td>
		<td class="hash_value">1</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">X-Content-Type-Options</td>
		<td class="hash_value">nosniff</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">X-FRAME-OPTIONS</td>
		<td class="hash_value">SAMEORIGIN</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">X-BackEnd-Begin</td>
		<td class="hash_value">2018-05-19T16:04:37.494</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">X-BackEnd-End</td>
		<td class="hash_value">2018-05-19T16:04:37.500</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">X-DiagInfo</td>
		<td class="hash_value">BY2PR05MB2311</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">X-BEServer</td>
		<td class="hash_value">BY2PR05MB2311</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">X-UA-Compatible</td>
		<td class="hash_value">IE=EmulateIE7</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">Strict-Transport-Security</td>
		<td class="hash_value">[max-age=31536000; includeSubDomains, max-age=31536000; includeSubDomains]</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">X-FEServer</td>
		<td class="hash_value">[BY2PR1001CA0073, DM5PR05CA0014]</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">X-Powered-By</td>
		<td class="hash_value">ASP.NET</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">Date</td>
		<td class="hash_value">Sat, 19 May 2018 16:04:37 GMT</td>
	</tr>
</table></td></tr>
	<tr class="slimRowColor9">
		<td>show</td>
		<td colspan="3">cookie values</td>
	<td><table class="hash_table">
	<tr class="hash_row">
		<td class="hash_key">ClientId</td>
		<td class="hash_value">321505A229534A33895E23B51F80B419</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">logonLatency</td>
		<td class="hash_value">LGN01=636623426774951346</td>
	</tr>
</table></td></tr>
	<tr class="slimRowColor0">
		<td>check</td>
		<td>cookie value</td>
		<td>ClientId</td>
		<td><span class="pass">$clientId1-&gt;[321505A229534A33895E23B51F80B419]</span></td>
	</tr>
</table>
<br/>Then two requestes one by browser and one by plain http: again same cookie on 2nd request (but not the same as first table).<br/><br/><table>
	<tr class="slimRowTitle">
		<td>script</td>
		<td colspan="3"><span class="pass">browser test</span></td>
	</tr>
	<tr class="slimRowColor4">
		<td><span class="pass">open</span></td>
		<td colspan="3"><a href="https://outlook.live.com/owa/">https://outlook.live.com/owa/</a></td>
	</tr>
	<tr class="slimRowColor9">
		<td>$clientId&lt;-[151A6F20D8AA4D5E888FCA9D72969FD8]</td>
		<td>cookie value</td>
		<td colspan="2">ClientId</td>
	</tr>
	<tr class="slimRowColor8">
		<td>note</td>
		<td colspan="3">see that we get different cookie value</td>
	</tr>
	<tr class="slimRowColor9">
		<td>check not</td>
		<td>cookie value</td>
		<td>ClientId</td>
		<td><span class="pass">$clientId1</span></td>
	</tr>
	<tr class="slimRowColor2">
		<td>$requ&lt;-[p:11111111&amp;v:16.2321.4.2552029&amp;l:mouse&amp;]</td>
		<td>cookie value</td>
		<td colspan="2">OWAPF</td>
	</tr>
	<tr class="slimRowColor5">
		<td>$loc&lt;-[https://outlook.live.com/owa/]</td>
		<td colspan="3">location</td>
	</tr>
</table>
<br/>Copying from browser's cookie store implicitly ensures cookies are stored/sent.<br/><br/><table>
	<tr class="slimRowTitle">
		<td>script</td>
		<td colspan="3"><span class="pass">http test</span></td>
	</tr>
	<tr class="slimRowColor8">
		<td>note</td>
		<td colspan="3">we set version information for cookies (Selenium cannot supply it)</td>
	</tr>
	<tr class="slimRowColor8">
		<td colspan="4">copy browser cookies</td>
	</tr>
	<tr class="slimRowColor0">
		<td>check</td>
		<td>cookie value</td>
		<td>ClientId</td>
		<td><span class="pass">$clientId-&gt;[151A6F20D8AA4D5E888FCA9D72969FD8]</span></td>
	</tr>
	<tr class="slimRowColor0">
		<td>check</td>
		<td>cookie value</td>
		<td>OWAPF</td>
		<td><span class="pass">$requ-&gt;[p:11111111&amp;v:16.2321.4.2552029&amp;l:mouse&amp;]</span></td>
	</tr>
	<tr class="slimRowColor8">
		<td><span class="pass">get from</span></td>
		<td colspan="3">$loc->[https://outlook.live.com/owa/]</td>
	</tr>
	<tr class="slimRowColor0">
		<td>check</td>
		<td>response status</td>
		<td colspan="2"><span class="pass">200</span></td>
	</tr>
	<tr class="slimRowColor9">
		<td>show</td>
		<td colspan="3">response headers</td>
	<td><table class="hash_table">
	<tr class="hash_row">
		<td class="hash_key">Cache-Control</td>
		<td class="hash_value">private</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">Content-Length</td>
		<td class="hash_value">3564</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">Content-Type</td>
		<td class="hash_value">text/html; charset=utf-8</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">Server</td>
		<td class="hash_value">Microsoft-IIS/10.0</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">request-id</td>
		<td class="hash_value">027c5799-c6c7-4988-97fb-aeb3b3ed1aad</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">X-CalculatedFETarget</td>
		<td class="hash_value">SN1PR19CU001.internal.outlook.com</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">X-BackEndHttpStatus</td>
		<td class="hash_value">[200, 200]</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">Set-Cookie</td>
		<td class="hash_value">[HostSwitchPrg=; expires=Thu, 19-May-1988 16:04:40 GMT; path=/; secure, OptInPrg=; expires=Thu, 19-May-1988 16:04:40 GMT; path=/; secure, logonLatency=LGN01=636623426801696955; domain=live.com; path=/; secure; HttpOnly, O365Consumer=; expires=Thu, 19-May-1988 16:04:40 GMT; path=/; secure, X-RouteRefreshCookie=zoHNz87H0s/K0s7Gq87Jxc/LxcvPgayxzq+tzsa8vs/PzsqBqoG8npmavo2Nnoa7nbiKlpvFyp7PyMaZnZvSmsmcyNLLycec0sbNnsrSyJnImczGycmex5rP2svP2svPkZ6Sj42bz8rRj42Qm9GQiouTkJCU0ZyQksK8npmavo2NnobFvbOqr63Pzs/OvKrPz87RlpGLmo2RnpPRkIqLk5CQlNGckJLazbyyqLevrc7IvKrPz8zRlpGLmo2RnpPRkIqLk5CQlNGckJLazbyssc6vrc7GvKrPz87RlpGLmo2RnpPRkIqLk5CQlNGckJLazby7ssqvrc7MvKrPz8zRlpGLmo2RnpPRkIqLk5CQlNGckJLUq42Kmr/P; expires=Sat, 19-May-2018 16:19:40 GMT; path=/, X-RouteRefreshCookie=zoHNz87H0s/K0s7Gq87Jxc/LxcvPgbuyyq+tz8q8vs/PzsuBqoG8npmavo2Nnoa7nbiKlpvFyp7PyMaZnZvSmsmcyNLLycec0sbNnsrSyJnImczGycmex5rP2svP2svPkZ6Sj42bz8rRj42Qm9GQiouTkJCU0ZyQksK8npmavo2NnobFvbOqr63Pzs/OvKrPz87RlpGLmo2RnpPRkIqLk5CQlNGckJLazbyyqLevrc7IvKrPz8zRlpGLmo2RnpPRkIqLk5CQlNGckJLazbyssc6vrc7GvKrPz87RlpGLmo2RnpPRkIqLk5CQlNGckJLazby7ssqvrc7MvKrPz8zRlpGLmo2RnpPRkIqLk5CQlNGckJLUq42Kmr/P; expires=Sat, 19-May-2018 16:19:40 GMT; path=/]</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">X-FEProxyInfo</td>
		<td class="hash_value">SN1PR19CA0015.NAMPRD19.PROD.OUTLOOK.COM</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">X-CalculatedBETarget</td>
		<td class="hash_value">BLUPR0501MB1060.namprd05.prod.outlook.com</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">X-RUM-Validated</td>
		<td class="hash_value">1</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">X-Content-Type-Options</td>
		<td class="hash_value">nosniff</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">X-FRAME-OPTIONS</td>
		<td class="hash_value">SAMEORIGIN</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">X-BackEnd-Begin</td>
		<td class="hash_value">2018-05-19T16:04:40.168</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">X-BackEnd-End</td>
		<td class="hash_value">2018-05-19T16:04:40.177</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">X-DiagInfo</td>
		<td class="hash_value">BLUPR0501MB1060</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">X-BEServer</td>
		<td class="hash_value">BLUPR0501MB1060</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">X-UA-Compatible</td>
		<td class="hash_value">IE=EmulateIE7</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">Strict-Transport-Security</td>
		<td class="hash_value">[max-age=31536000; includeSubDomains, max-age=31536000; includeSubDomains]</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">X-FEServer</td>
		<td class="hash_value">[SN1PR19CA0015, DM5PR05CA0014]</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">X-Powered-By</td>
		<td class="hash_value">ASP.NET</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">Date</td>
		<td class="hash_value">Sat, 19 May 2018 16:04:40 GMT</td>
	</tr>
</table></td></tr>
	<tr class="slimRowColor9">
		<td>show</td>
		<td colspan="3">cookie values</td>
	<td><table class="hash_table">
	<tr class="hash_row">
		<td class="hash_key">ClientId</td>
		<td class="hash_value">151A6F20D8AA4D5E888FCA9D72969FD8</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">MSFPC</td>
		<td class="hash_value">GUID=e093448fa1e440a68e81f4e7ca70ae50&amp;HASH=e093&amp;LV=201805&amp;V=4&amp;LU=1526745878807</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">OWAPF</td>
		<td class="hash_value">p:11111111&amp;v:16.2321.4.2552029&amp;l:mouse&amp;</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">X-RouteRefreshCookie</td>
		<td class="hash_value">zoHNz87H0s/K0s7Gq87Jxc/LxcvPgbuyyq+tz8q8vs/PzsuBqoG8npmavo2Nnoa7nbiKlpvFyp7PyMaZnZvSmsmcyNLLycec0sbNnsrSyJnImczGycmex5rP2svP2svPkZ6Sj42bz8rRj42Qm9GQiouTkJCU0ZyQksK8npmavo2NnobFvbOqr63Pzs/OvKrPz87RlpGLmo2RnpPRkIqLk5CQlNGckJLazbyyqLevrc7IvKrPz8zRlpGLmo2RnpPRkIqLk5CQlNGckJLazbyssc6vrc7GvKrPz87RlpGLmo2RnpPRkIqLk5CQlNGckJLazby7ssqvrc7MvKrPz8zRlpGLmo2RnpPRkIqLk5CQlNGckJLUq42Kmr/P</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">logonLatency</td>
		<td class="hash_value">LGN01=636623426801696955</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">optimizelyEndUserId</td>
		<td class="hash_value">oeu1526745875834r0.9251360814432006</td>
	</tr>
</table></td></tr>
	<tr class="slimRowColor8">
		<td>note</td>
		<td colspan="3">see that we get same cookie value as we copied from browser</td>
	</tr>
	<tr class="slimRowColor0">
		<td>check</td>
		<td>cookie value</td>
		<td>ClientId</td>
		<td><span class="pass">$clientId-&gt;[151A6F20D8AA4D5E888FCA9D72969FD8]</span></td>
	</tr>
</table>
<br/></article></body></html>
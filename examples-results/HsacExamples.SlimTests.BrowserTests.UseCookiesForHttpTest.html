<html><head><title>HsacExamples.SlimTests.BrowserTests.UseCookiesForHttpTest</title><meta http-equiv='Content-Type' content='text/html;charset=UTF-8'/><link rel='stylesheet' type='text/css' href='css/fitnesse.css'/><script src='javascript/jquery-1.11.3.min.js' type='text/javascript'></script><script src='javascript/fitnesse.js' type='text/javascript'></script></head><body><header><h2>HsacExamples.SlimTests.BrowserTests.UseCookiesForHttpTest</h2></header><article><br/>By taking cookies from a browser's session we can test REST services that are only accessible in after (complex) login procedures.<br/><br/>Here we don't actually test a login procedure. We just validate cookies are copied and subsequent requests by http test can change the cookies stored.<br/><br/>First http test on its own: 2nd request (with cookies from 1st) gets same cookie value.<br/><br/><table>
	<tr class="slimRowTitle">
		<td>script</td>
		<td colspan="3"><span class="pass">http test</span></td>
	</tr>
	<tr class="slimRowColor2">
		<td>set store cookies</td>
		<td colspan="3">true</td>
	</tr>
	<tr class="slimRowColor8">
		<td><span class="pass">get from</span></td>
		<td colspan="3"><a href="https://mail.live.com/default.aspx">https://mail.live.com/default.aspx</a></td>
	</tr>
	<tr class="slimRowColor0">
		<td>check</td>
		<td>response status</td>
		<td colspan="2"><span class="pass">200</span></td>
	</tr>
	<tr class="slimRowColor9">
		<td>show</td>
		<td colspan="3">response headers</td>
	<td><table class="hash_table">
	<tr class="hash_row">
		<td class="hash_key">Cache-Control</td>
		<td class="hash_value">private</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">Content-Length</td>
		<td class="hash_value">3566</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">Content-Type</td>
		<td class="hash_value">text/html; charset=utf-8</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">Set-Cookie</td>
		<td class="hash_value">[ClientId=BCA380744A364117844590A88BD0E53D; expires=Sat, 22-Dec-2018 14:52:51 GMT; path=/; secure, ClientId=BCA380744A364117844590A88BD0E53D; expires=Sat, 22-Dec-2018 14:52:51 GMT; path=/; secure, HostSwitchPrg=; expires=Tue, 22-Dec-1987 14:52:51 GMT; path=/; secure, OptInPrg=; expires=Tue, 22-Dec-1987 14:52:51 GMT; path=/; secure, logonLatency=LGN01=636495511710806362; domain=live.com; path=/; secure; HttpOnly, O365Consumer=; expires=Tue, 22-Dec-1987 14:52:51 GMT; path=/; secure]</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">request-id</td>
		<td class="hash_value">ab3a383c-cc49-4887-ac2d-19e76854f220</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">X-CalculatedFETarget</td>
		<td class="hash_value">MWHPR04CU002.internal.outlook.com</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">X-BackEndHttpStatus</td>
		<td class="hash_value">[200, 200]</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">X-FEProxyInfo</td>
		<td class="hash_value">MWHPR04CA0037.NAMPRD04.PROD.OUTLOOK.COM</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">X-CalculatedBETarget</td>
		<td class="hash_value">CO2PR15MB0105.namprd15.prod.outlook.com</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">X-Content-Type-Options</td>
		<td class="hash_value">nosniff</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">X-FRAME-OPTIONS</td>
		<td class="hash_value">SAMEORIGIN</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">X-BackEnd-Begin</td>
		<td class="hash_value">2017-12-22T14:52:51.078</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">X-BackEnd-End</td>
		<td class="hash_value">2017-12-22T14:52:51.085</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">X-DiagInfo</td>
		<td class="hash_value">CO2PR15MB0105</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">X-BEServer</td>
		<td class="hash_value">CO2PR15MB0105</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">X-UA-Compatible</td>
		<td class="hash_value">IE=EmulateIE7</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">Strict-Transport-Security</td>
		<td class="hash_value">[max-age=31536000; includeSubDomains, max-age=31536000; includeSubDomains]</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">X-FEServer</td>
		<td class="hash_value">[MWHPR04CA0037, BL0PR1501CA0026]</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">X-Powered-By</td>
		<td class="hash_value">ASP.NET</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">X-MSEdge-Ref</td>
		<td class="hash_value">Ref A: F0064F6A80384713A295399B3FE0040A Ref B: ASHEDGE0607 Ref C: 2017-12-22T14:52:51Z</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">Date</td>
		<td class="hash_value">Fri, 22 Dec 2017 14:52:50 GMT</td>
	</tr>
</table></td></tr>
	<tr class="slimRowColor9">
		<td>show</td>
		<td colspan="3">cookie values</td>
	<td><table class="hash_table">
	<tr class="hash_row">
		<td class="hash_key">ClientId</td>
		<td class="hash_value">BCA380744A364117844590A88BD0E53D</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">logonLatency</td>
		<td class="hash_value">LGN01=636495511710806362</td>
	</tr>
</table></td></tr>
	<tr class="slimRowColor9">
		<td>check not</td>
		<td>cookie value</td>
		<td>uaid</td>
		<td><span class="fail">null</span></td>
	</tr>
	<tr class="slimRowColor5">
		<td>$uaid1&lt;-[null]</td>
		<td>cookie value</td>
		<td colspan="2">uaid</td>
	</tr>
	<tr class="slimRowColor8">
		<td>note</td>
		<td colspan="3">see that we get same cookie value again</td>
	</tr>
	<tr class="slimRowColor8">
		<td><span class="pass">get from</span></td>
		<td colspan="3"><a href="https://mail.live.com/default.aspx">https://mail.live.com/default.aspx</a></td>
	</tr>
	<tr class="slimRowColor0">
		<td>check</td>
		<td>response status</td>
		<td colspan="2"><span class="pass">200</span></td>
	</tr>
	<tr class="slimRowColor9">
		<td>show</td>
		<td colspan="3">response headers</td>
	<td><table class="hash_table">
	<tr class="hash_row">
		<td class="hash_key">Cache-Control</td>
		<td class="hash_value">private</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">Content-Length</td>
		<td class="hash_value">3566</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">Content-Type</td>
		<td class="hash_value">text/html; charset=utf-8</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">Set-Cookie</td>
		<td class="hash_value">[HostSwitchPrg=; expires=Tue, 22-Dec-1987 14:52:51 GMT; path=/; secure, OptInPrg=; expires=Tue, 22-Dec-1987 14:52:51 GMT; path=/; secure, logonLatency=LGN01=636495511714682005; domain=live.com; path=/; secure; HttpOnly, O365Consumer=; expires=Tue, 22-Dec-1987 14:52:51 GMT; path=/; secure]</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">request-id</td>
		<td class="hash_value">063235be-36b0-410c-918f-096a9ba853a9</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">X-CalculatedFETarget</td>
		<td class="hash_value">BN3PR11CU001.internal.outlook.com</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">X-BackEndHttpStatus</td>
		<td class="hash_value">[200, 200]</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">X-FEProxyInfo</td>
		<td class="hash_value">BN3PR11CA0007.NAMPRD11.PROD.OUTLOOK.COM</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">X-CalculatedBETarget</td>
		<td class="hash_value">BLUPR15MB0033.namprd15.prod.outlook.com</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">X-Content-Type-Options</td>
		<td class="hash_value">nosniff</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">X-FRAME-OPTIONS</td>
		<td class="hash_value">SAMEORIGIN</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">X-BackEnd-Begin</td>
		<td class="hash_value">2017-12-22T14:52:51.452</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">X-BackEnd-End</td>
		<td class="hash_value">2017-12-22T14:52:51.515</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">X-DiagInfo</td>
		<td class="hash_value">BLUPR15MB0033</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">X-BEServer</td>
		<td class="hash_value">BLUPR15MB0033</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">X-UA-Compatible</td>
		<td class="hash_value">IE=EmulateIE7</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">Strict-Transport-Security</td>
		<td class="hash_value">[max-age=31536000; includeSubDomains, max-age=31536000; includeSubDomains]</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">X-FEServer</td>
		<td class="hash_value">[BN3PR11CA0007, BL0PR1501CA0030]</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">X-Powered-By</td>
		<td class="hash_value">ASP.NET</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">X-MSEdge-Ref</td>
		<td class="hash_value">Ref A: AC01852DAC74481C8481F74F05F7F021 Ref B: ASHEDGE0506 Ref C: 2017-12-22T14:52:51Z</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">Date</td>
		<td class="hash_value">Fri, 22 Dec 2017 14:52:50 GMT</td>
	</tr>
</table></td></tr>
	<tr class="slimRowColor9">
		<td>show</td>
		<td colspan="3">cookie values</td>
	<td><table class="hash_table">
	<tr class="hash_row">
		<td class="hash_key">ClientId</td>
		<td class="hash_value">BCA380744A364117844590A88BD0E53D</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">logonLatency</td>
		<td class="hash_value">LGN01=636495511714682005</td>
	</tr>
</table></td></tr>
	<tr class="slimRowColor0">
		<td>check</td>
		<td>cookie value</td>
		<td>uaid</td>
		<td><span class="pass">$uaid1-&gt;[null]</span></td>
	</tr>
</table>
<br/>Then two requestes one by browser and one by plain http: again same cookie on 2nd request (but not the same as first table).<br/><br/><table>
	<tr class="slimRowTitle">
		<td>script</td>
		<td colspan="3"><span class="pass">browser test</span></td>
	</tr>
	<tr class="slimRowColor4">
		<td><span class="pass">open</span></td>
		<td colspan="3"><a href="https://mail.live.com/default.aspx">https://mail.live.com/default.aspx</a></td>
	</tr>
	<tr class="slimRowColor6">
		<td>$uaid&lt;-[null]</td>
		<td>cookie value</td>
		<td colspan="2">uaid</td>
	</tr>
	<tr class="slimRowColor8">
		<td>note</td>
		<td colspan="3">see that we get different cookie value</td>
	</tr>
	<tr class="slimRowColor9">
		<td>check not</td>
		<td>cookie value</td>
		<td>uaid</td>
		<td><span class="fail">$uaid1-&gt;[null]</span></td>
	</tr>
	<tr class="slimRowColor3">
		<td>$ck&lt;-[null]</td>
		<td>cookie value</td>
		<td colspan="2">CkTst</td>
	</tr>
	<tr class="slimRowColor7">
		<td>$pok&lt;-[null]</td>
		<td>cookie value</td>
		<td colspan="2">MSPOK</td>
	</tr>
	<tr class="slimRowColor2">
		<td>$requ&lt;-[null]</td>
		<td>cookie value</td>
		<td colspan="2">MSPRequ</td>
	</tr>
	<tr class="slimRowColor5">
		<td>$loc&lt;-[https://outlook.live.com/owa/]</td>
		<td colspan="3">location</td>
	</tr>
</table>
<br/>Copying from browser's cookie store implicitly ensures cookies are stored/sent.<br/><br/><table>
	<tr class="slimRowTitle">
		<td>script</td>
		<td colspan="3"><span class="pass">http test</span></td>
	</tr>
	<tr class="slimRowColor8">
		<td>note</td>
		<td colspan="3">we set version information for cookies (Selenium cannot supply it)</td>
	</tr>
	<tr class="slimRowColor8">
		<td colspan="4">copy browser cookies</td>
	</tr>
	<tr class="slimRowColor0">
		<td>check</td>
		<td>cookie value</td>
		<td>uaid</td>
		<td><span class="pass">$uaid-&gt;[null]</span></td>
	</tr>
	<tr class="slimRowColor0">
		<td>check</td>
		<td>cookie value</td>
		<td>CkTst</td>
		<td><span class="pass">$ck-&gt;[null]</span></td>
	</tr>
	<tr class="slimRowColor0">
		<td>check</td>
		<td>cookie value</td>
		<td>MSPOK</td>
		<td><span class="pass">$pok-&gt;[null]</span></td>
	</tr>
	<tr class="slimRowColor0">
		<td>check</td>
		<td>cookie value</td>
		<td>MSPRequ</td>
		<td><span class="pass">$requ-&gt;[null]</span></td>
	</tr>
	<tr class="slimRowColor8">
		<td><span class="pass">get from</span></td>
		<td colspan="3">$loc->[https://outlook.live.com/owa/]</td>
	</tr>
	<tr class="slimRowColor0">
		<td>check</td>
		<td>response status</td>
		<td colspan="2"><span class="pass">200</span></td>
	</tr>
	<tr class="slimRowColor9">
		<td>show</td>
		<td colspan="3">response headers</td>
	<td><table class="hash_table">
	<tr class="hash_row">
		<td class="hash_key">Cache-Control</td>
		<td class="hash_value">private</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">Content-Length</td>
		<td class="hash_value">3566</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">Content-Type</td>
		<td class="hash_value">text/html; charset=utf-8</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">Set-Cookie</td>
		<td class="hash_value">[HostSwitchPrg=; expires=Tue, 22-Dec-1987 14:52:54 GMT; path=/; secure, OptInPrg=; expires=Tue, 22-Dec-1987 14:52:54 GMT; path=/; secure, logonLatency=LGN01=636495511745527962; domain=live.com; path=/; secure; HttpOnly, O365Consumer=; expires=Tue, 22-Dec-1987 14:52:54 GMT; path=/; secure]</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">request-id</td>
		<td class="hash_value">5363d5fa-7c29-4d86-976d-06cb2aef6873</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">X-CalculatedFETarget</td>
		<td class="hash_value">BLUPR0101CU001.internal.outlook.com</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">X-BackEndHttpStatus</td>
		<td class="hash_value">[200, 200]</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">X-FEProxyInfo</td>
		<td class="hash_value">BLUPR0101CA0027.PROD.EXCHANGELABS.COM</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">X-CalculatedBETarget</td>
		<td class="hash_value">BL2PR15MB1009.namprd15.prod.outlook.com</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">X-Content-Type-Options</td>
		<td class="hash_value">nosniff</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">X-FRAME-OPTIONS</td>
		<td class="hash_value">SAMEORIGIN</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">X-BackEnd-Begin</td>
		<td class="hash_value">2017-12-22T14:52:54.552</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">X-BackEnd-End</td>
		<td class="hash_value">2017-12-22T14:52:54.568</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">X-DiagInfo</td>
		<td class="hash_value">BL2PR15MB1009</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">X-BEServer</td>
		<td class="hash_value">BL2PR15MB1009</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">X-UA-Compatible</td>
		<td class="hash_value">IE=EmulateIE7</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">Strict-Transport-Security</td>
		<td class="hash_value">[max-age=31536000; includeSubDomains, max-age=31536000; includeSubDomains]</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">X-FEServer</td>
		<td class="hash_value">[BLUPR0101CA0027, BL0PR1501CA0018]</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">X-Powered-By</td>
		<td class="hash_value">ASP.NET</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">X-MSEdge-Ref</td>
		<td class="hash_value">Ref A: 63996BE0265443EBAFCB53C91AE1AC55 Ref B: ASHEDGE0415 Ref C: 2017-12-22T14:52:54Z</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">Date</td>
		<td class="hash_value">Fri, 22 Dec 2017 14:52:53 GMT</td>
	</tr>
</table></td></tr>
	<tr class="slimRowColor9">
		<td>show</td>
		<td colspan="3">cookie values</td>
	<td><table class="hash_table">
	<tr class="hash_row">
		<td class="hash_key">ClientId</td>
		<td class="hash_value">6EEA949E36444150B3582E1D39660948</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">MSFPC</td>
		<td class="hash_value">GUID=b6894297cae747ee96137fea0a46adc1&amp;HASH=b689&amp;LV=201712&amp;V=4&amp;LU=1513954372703</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">OWAPF</td>
		<td class="hash_value">p:11111111&amp;v:16.2061.3.2457658&amp;l:mouse&amp;</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">logonLatency</td>
		<td class="hash_value">LGN01=636495511745527962</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">optimizelyEndUserId</td>
		<td class="hash_value">oeu1513954368027r0.5361220490623466</td>
	</tr>
</table></td></tr>
	<tr class="slimRowColor8">
		<td>note</td>
		<td colspan="3">see that we get same cookie value as we copied from browser</td>
	</tr>
	<tr class="slimRowColor0">
		<td>check</td>
		<td>cookie value</td>
		<td>uaid</td>
		<td><span class="pass">$uaid-&gt;[null]</span></td>
	</tr>
</table>
<br/></article></body></html>